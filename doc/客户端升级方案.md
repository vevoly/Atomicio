## 客户端升级方案 （第一次升级）v0.6.7

```mermaid
graph TD
    subgraph "用户应用空间 (User Application)"
        A[<b>用户代码</b><br>e.g., Spring Service, UI Controller]
        B[<b>用户监听器</b><br>e.g., onPushMessage, onDisconnected]
        C[<b>application.yml</b><br>配置 host, port, deviceId, etc.]
    end

    subgraph "<b>AtomicIO 客户端 SDK (atomicio-client-starter)</b>"
        subgraph "API 外观层 (Facade)"
            D{<b>AtomicIOClient</b><br> Bean}
        end

        subgraph "核心管理器 (Core Managers)"
            E[<b>RequestManager</b><br>SequenceId & Future 匹配]
            F[<b>HeartbeatManager</b><br>定时心跳 & 死链检测]
            G[<b>ReconnectionManager</b><br> 自动重连策略]
        end

        subgraph "网络处理层 (Netty Pipeline)"
            H[Channel]
            I{<b>协议编解码器</b><br>Protobuf/Text Codec}
            J[<b>ClientMessageHandler</b><br>智能路由]
        end

        subgraph "配置与自动装配"
            K[<b>AtomicIOClientProperties</b><br>@ConfigurationProperties]
            L[<b>AtomicIOClientAutoConfiguration</b><br>创建所有 Beans]
        end
    end

    subgraph "网络"
        M[远程 AtomicIO 服务器]
    end

    %% 关系连线
    A -- "调用高级 API (login, sendMessage)" --> D
    D -- "注册监听器" --> B
    C -- "加载配置" --> K
    K -- "提供配置" --> L
    
    L -- "创建" --> D
    L -- "创建" --> E & F & G
    L -- "配置 Pipeline" --> J & I

    D -- "委托" --> E
    D -- "控制" --> F & G
    
    E -- "被调用" --> J
    
    D -- "发起网络请求" --> H
    H <--> I <--> J
    H <--> M

    M -- "推送消息" --> H
    J -- "触发回调" --> B
```